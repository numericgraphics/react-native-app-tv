var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _FocusableHighlight=require("../focusable/FocusableHighlight");var _CustomDrawerDefaultStyle=require("../styles/CustomDrawerDefaultStyle.style");var _tools=require("../utils/tools");var _ColorIcon=_interopRequireDefault(require("../items/ColorIcon"));var _TVAPPContext=_interopRequireDefault(require("../TVAPPContext/TVAPPContext"));var _jsxFileName="/Users/rinaldo/Documents/React-native/npm-package/RTSAppTv/src/lib/CustomDrawer/CustomDrawer.js";function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function CustomDrawer(_ref){var _this=this;var theme=_ref.theme,navigation=_ref.navigation,state=_ref.state,miniWidth=_ref.miniWidth,maxWidth=_ref.maxWidth,_ref$options=_ref.options,options=_ref$options===void 0?{}:_ref$options,timeOutValue=_ref.timeOutValue;var _useContext=(0,_react.useContext)(_TVAPPContext.default),GlobalState=_useContext.GlobalState,FocusManager=_useContext.FocusManager;var dispatchGlobalState=GlobalState.dispatchGlobalState,GlobalStates=GlobalState.GlobalStates;var routes=state.routes;var _useState=(0,_react.useState)(new _reactNative.Animated.Value(miniWidth)),_useState2=(0,_slicedToArray2.default)(_useState,1),scaleValue=_useState2[0];var _useState3=(0,_react.useState)(false),_useState4=(0,_slicedToArray2.default)(_useState3,2),isDrawerOpen=_useState4[0],setDrawerOpen=_useState4[1];var _useState5=(0,_react.useState)(false),_useState6=(0,_slicedToArray2.default)(_useState5,2),isFocused=_useState6[0],setFocused=_useState6[1];var _useState7=(0,_react.useState)(undefined),_useState8=(0,_slicedToArray2.default)(_useState7,2),icons=_useState8[0],setIcons=_useState8[1];var _useState9=(0,_react.useState)(undefined),_useState10=(0,_slicedToArray2.default)(_useState9,2),customNavigation=_useState10[0],setCustomNavigation=_useState10[1];var style=(0,_extends2.default)({},_CustomDrawerDefaultStyle.CustomDrawerDefaultStyle,theme);var buttonsRef=(0,_react.useRef)([]);function focused(){_reactNative.Animated.timing(scaleValue,{toValue:maxWidth,duration:350,useNativeDriver:false}).start(function(){setDrawerOpen(true);dispatchGlobalState({type:GlobalStates.DRAWER_OPEN});});}function unFocused(){setDrawerOpen(false);_reactNative.Animated.timing(scaleValue,{toValue:miniWidth,duration:350,useNativeDriver:false}).start(function(){dispatchGlobalState({type:GlobalStates.DRAWER_CLOSE});});}function _onFocus(){setFocused(true);navigation.openDrawer();if(!isDrawerOpen){focused();}}function _onBlur(){setFocused(false);}function _onLayout(name,index){FocusManager.setDrawer({name:name,ref:buttonsRef.current[index]});}function _onPress(route){navigation.navigate(route);navigation.closeDrawer();}var getRandomColor=(0,_react.useMemo)(function(){return"#"+(0,_tools.randomColors)();},[]);var createCustomNavigation=(0,_react.useCallback)(function(){return customNavigation.map(function(item,index){return _react.default.createElement(_FocusableHighlight.FocusableHighlight,{key:"customNavigation"+index,onFocus:function onFocus(){return _onFocus();},onBlur:function onBlur(){return _onBlur();},onPress:function onPress(){item.action(item);navigation.closeDrawer();},style:style.cell,styleFocused:style.focusedCell,__self:_this,__source:{fileName:_jsxFileName,lineNumber:103,columnNumber:17}},_react.default.createElement(_reactNative.View,{style:style.contentContainer,__self:_this,__source:{fileName:_jsxFileName,lineNumber:113,columnNumber:21}},item.source?getIcon(item.source):_react.default.createElement(_ColorIcon.default,{size:28,color:getRandomColor,__self:_this,__source:{fileName:_jsxFileName,lineNumber:114,columnNumber:63}}),isDrawerOpen&&_react.default.createElement(_reactNative.Text,{style:style.text,__self:_this,__source:{fileName:_jsxFileName,lineNumber:115,columnNumber:42}},item.name)));});},[]);function getRef(index){return function(ref){buttonsRef.current[index]=ref;};}var getIcon=function getIcon(source){return _react.default.createElement(_reactNative.Image,{style:style.logo,source:{uri:_reactNative.Image.resolveAssetSource(source).uri},__self:_this,__source:{fileName:_jsxFileName,lineNumber:131,columnNumber:16}});};var getIconWeb=function getIconWeb(source){return _react.default.createElement(_reactNative.Image,{style:style.logo,source:source.default,__self:_this,__source:{fileName:_jsxFileName,lineNumber:138,columnNumber:16}});};var getNextFocusRight=(0,_react.useCallback)(function(){var nextFocusRight=FocusManager.getFocus();return(0,_reactNative.findNodeHandle)(nextFocusRight.ref);},[]);(0,_react.useEffect)(function(){if(Object.entries(options).length>0){for(var _i=0,_Object$entries=Object.entries(options);_i<_Object$entries.length;_i++){var _ref2=_Object$entries[_i];var _ref3=(0,_slicedToArray2.default)(_ref2,2);var key=_ref3[0];var value=_ref3[1];if(key==='icons'){setIcons(value);}else if(key==='customNavigation'){setCustomNavigation(value);}}}return function(){console.log('CustomDrawer LEAVE');};},[]);(0,_react.useEffect)(function(){var timeout=setTimeout(function(){if(!isFocused){unFocused();}},timeOutValue);return function(){return clearTimeout(timeout);};},[isFocused]);return _react.default.createElement(_reactNative.Animated.View,{style:[style.container,{width:scaleValue}],__self:this,__source:{fileName:_jsxFileName,lineNumber:171,columnNumber:9}},routes.map(function(route,index){return _react.default.createElement(_FocusableHighlight.FocusableHighlight,{key:index,ref:getRef(index),onFocus:function onFocus(){return _onFocus();},onBlur:function onBlur(){return _onBlur();},onPress:function onPress(){return _onPress(route);},style:style.cell,styleFocused:style.focusedCell,onLayout:function onLayout(){return _onLayout(route.name,index);},nextFocusRight:getNextFocusRight(),__self:_this,__source:{fileName:_jsxFileName,lineNumber:176,columnNumber:21}},_react.default.createElement(_reactNative.View,{style:style.contentContainer,__self:_this,__source:{fileName:_jsxFileName,lineNumber:187,columnNumber:25}},icons&&icons[index].source?_reactNative.Platform.OS==='web'?getIconWeb(icons[index].source):getIcon(icons[index].source):_react.default.createElement(_ColorIcon.default,{size:28,color:getRandomColor,__self:_this,__source:{fileName:_jsxFileName,lineNumber:192,columnNumber:35}}),isDrawerOpen&&_react.default.createElement(_reactNative.Text,{style:style.text,__self:_this,__source:{fileName:_jsxFileName,lineNumber:193,columnNumber:46}},route.name)));}),customNavigation&&createCustomNavigation());}var _default=(0,_react.memo)(CustomDrawer);exports.default=_default;