var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _react=_interopRequireWildcard(require("react"));var _GlobalReducer=require("../reducers/GlobalReducer");var _TVAPPContext=_interopRequireDefault(require("../TVAPPContext"));var _TVFocusManager=_interopRequireDefault(require("../managers/TVFocusManager"));var _DefaultFocusManager=_interopRequireDefault(require("../managers/DefaultFocusManager"));var _reactNative=require("react-native");var _tools=require("../utils/tools");var _KeyEventsReducer=require("../reducers/KeyEventsReducer");var _ThemeSRG=require("../theme/ThemeSRG");var _jsxFileName="/Users/rinaldo/Documents/React-native/npm-package/RTSAppTv/src/lib/TVAPPProvider/TVAPPProvider.js";var _excluded=["children"];function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function TVAPPProvider(_ref){var _this=this;var children=_ref.children,props=(0,_objectWithoutProperties2.default)(_ref,_excluded);var config=props.config;var SRGExitApp=_reactNative.NativeModules.SRGExitApp;var _useReducer=(0,_react.useReducer)(_KeyEventsReducer.KeyEventsReducer,_KeyEventsReducer.InitialKeyEventState),_useReducer2=(0,_slicedToArray2.default)(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var KeyEventState={state:state,dispatch:dispatch,KeyEventStates:_KeyEventsReducer.KeyEventStates};var _useReducer3=(0,_react.useReducer)(_GlobalReducer.GlobalReducer,_GlobalReducer.InitialGlobalState),_useReducer4=(0,_slicedToArray2.default)(_useReducer3,2),globalState=_useReducer4[0],dispatchGlobalState=_useReducer4[1];var GlobalState={globalState:globalState,dispatchGlobalState:dispatchGlobalState,GlobalStates:_GlobalReducer.GlobalStates};var _useState=(0,_react.useState)({ThemeSRG:_ThemeSRG.ThemeSRG}),_useState2=(0,_slicedToArray2.default)(_useState,2),theme=_useState2[0],setTVAPPContextTheme=_useState2[1];var _useState3=(0,_react.useState)('Home'),_useState4=(0,_slicedToArray2.default)(_useState3,2),root=_useState4[0],setRoot=_useState4[1];var _useState5=(0,_react.useState)(undefined),_useState6=(0,_slicedToArray2.default)(_useState5,2),navigation=_useState6[0],setNavigation=_useState6[1];var _useState7=(0,_react.useState)(_DefaultFocusManager.default),_useState8=(0,_slicedToArray2.default)(_useState7,2),FocusManager=_useState8[0],setFocusManager=_useState8[1];var Theme={theme:theme,setTVAPPContextTheme:setTVAPPContextTheme};function backAction(e){if((navigation==null?void 0:navigation.current.getCurrentRoute().name)===root&&_reactNative.Platform.OS==='ios'){SRGExitApp.exitApp();}try{return!!(navigation!=null&&navigation.current&&(navigation==null?void 0:navigation.current.getCurrentRoute().name)===root);}catch(e){console.log('TVAPPProvider backAction ERROR',e);}}function tvEventHandling(cmp,e){if(e.eventType==='left'||e.eventType==='right'||e.eventType==='up'||e.eventType==='down'){dispatch({type:"Arrow"+(0,_tools.capitalizeFirstLetter)(e.eventType),payload:{timeStamp:Date.now()}});}}function keyDownAction(e){try{if(e.code==='Escape'&&(navigation==null?void 0:navigation.current.getCurrentRoute().name)!==root){console.log('TVAPPProvider - keyDownAction history back');navigation==null?void 0:navigation.current.goBack();}if(e.code==='ArrowRight'||e.code==='ArrowLeft'||e.code==='ArrowDown'||e.code==='ArrowUp'){dispatch({type:e.code,payload:{timeStamp:e.timeStamp}});}}catch(e){console.log('TVAPPProvider - keyDownAction ERROR',e);}}(0,_react.useEffect)(function(){switch(globalState.type){case _GlobalReducer.GlobalStates.CHANGE_THEME:console.log('TVAPPProvider - CHANGE_THEME',globalState);break;case _GlobalReducer.GlobalStates.DRAWER_OPEN:console.log('TVAPPProvider - DRAWER_OPEN',globalState);break;case _GlobalReducer.GlobalStates.DRAWER_CLOSE:console.log('TVAPPProvider - DRAWER_CLOSE',globalState);break;}},[globalState]);(0,_react.useEffect)(function(){console.log('TVAPPProvider - useEffect init');if(Object.entries(config).length>0){for(var _i=0,_Object$entries=Object.entries(config);_i<_Object$entries.length;_i++){var _ref2=_Object$entries[_i];var _ref3=(0,_slicedToArray2.default)(_ref2,2);var key=_ref3[0];var value=_ref3[1];if(key==='focusManager'){if(value instanceof _TVFocusManager.default){setFocusManager(value);}else{console.log('TVAPPProvider - ERROR - focusManager object is not valid or not a instance of FocusManager');}}else if(key==='focus'){FocusManager.setFocus(value);}else if(key==='theme'){setTVAPPContextTheme(value);}else if(key==='root'){setRoot(value);}else if(key==='navigation'){if(value.current){setNavigation(value);}else{console.log('TVAPPProvider - ERROR - navigation reference is not valid');}}}}if(_reactNative.Platform.OS!=='web'){var tvEventHandler=new _reactNative.TVEventHandler();_reactNative.BackHandler.addEventListener('hardwareBackPress',backAction);tvEventHandler.enable(_this,tvEventHandling);return function(){console.log('TVAPPProvider - useEffect natif - killed');_reactNative.BackHandler.removeEventListener('hardwareBackPress',backAction);tvEventHandler.disable();};}else{window.addEventListener('keydown',keyDownAction);return function(){console.log('APP - useEffect web - killed');window.removeEventListener('keydown',keyDownAction);};}},[]);return _react.default.createElement(_TVAPPContext.default.Provider,{value:{KeyEventState:KeyEventState,GlobalState:GlobalState,FocusManager:FocusManager,Theme:Theme},__self:this,__source:{fileName:_jsxFileName,lineNumber:132,columnNumber:12}},children);}var _default=TVAPPProvider;exports.default=_default;